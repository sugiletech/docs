# Understanding Event Driven Architecture

#design-pattern 

- Uses `events` to trigger and communicate between decoupled services
- An event is a change in state or an update
- Events can either carry the state or events can be identifiers
- Key components
  - Event Producers
  - Event Routers
  - Event Consumers

## Benefits

### Scale and fail independently

- The event router acts as an elastic buffer that will accomodate surges in workloads.

### Develop with agility

- No longer need to write custom code to poll, filter and route events
- Event route filter and push events to consumers

### Audit with ease

- Event router acts as a centralized location to audit your application and define policies

### Cut costs

- Push based on-demand system does not require paying for continous polling to check for event. So less network bandwidth consumption, less CPU utilization, less SSL/TLS handshakes.


## When to use?

- Cross-account, cross-region data replication
- Resource state monitoring and alerting
- Fanout and parallel processing - To `fanout the event without writing custom code to push` to each consumer.
- Integration of heterogeneous systems

## Things to consider before using event-driven architecture

- Durability of Event Source - should be `reliable and guarantee delivery` if need to process every single event.
- Performance Control Requirements - Application should be able to handle `asynchronous nature of event routes`.
- Event Flow Tracking - Indirection introduced by an event-driven architecture allows for `dynamic tracking` via monitoring services, but `not static tracking` via code analysis.
- Lack of Atomic Transaction - for single business process
- Data in Event Source - If you need to rebuild state, your `event source should be deduplicated and ordered`.


## Topologies

### Broker Topology

- Used when you want `to chain events together` without the use of a central mediator
- Useful when you have relatively simple event processing flow and no need of central orchestration
- Message flow is `distributed across the event processor` components in chain-like fashion through lightweight message broker like ActiveMQ, HornetQ etc.
- Components
  - Broker
    - Can be centralized or federated
    - Contains all of the event channels that are used within flow
    - Event channels can be message queue, message topics, or a combination
  - Even Processor
- Eg: Relay Race

![Event-driven architecture broker topology](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781491971437/files/assets/sapr_0203.png "Event-driven architecture broker topology")

![Broker topology example](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781491971437/files/assets/sapr_0204.png "Broker topology example")

### Mediator Topology

- Used when you need `to orchestrate multiple steps` within an event through a central mediator
- Useful for events that have multiple steps and require some level of orchestration to process the event
- Types of architecture components:
  - Event Queues 
    - Used to transport event to the event mediator
    - Eg: Message Queue, Web Service Endpoint
  - Event Mediator
    - Receives initial event and orchestrates that event by sending additional async events to event channels for each steps contained withing inital event
    - Doesnâ€™t actually perform the business logic necessary to process the initial event; rather `knows steps required to process initial event`
    - Eg: Open source integration hubs like Spring Integration, Apache Camel, or Mule ESB.
    - Eg: Sophesticated Mediation: BPEL such as Apache ODE, BPM such as jBPM and Camunda
  - Event Channels
    - Executes each step of the process
    - Eg: Message Queue, Message Topics
  - Event Processors
    - Listen to event channels, receive the event from event mediator and `execute specific business logic` to process the event
    - Contain application business logic necessary to process the processing event
    - Self contained, independent, highly decoupled components which performs specific task
    - Should perform single business task `without relying on other event processors`
- Event Types:
  - Initial Event - original event received by mediator
  - Processing Event - generated by mediator / received by event-processing components

![Event-driven architecture mediator topology](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781491971437/files/assets/sapr_0201.png "Event-driven architecture mediator topology")
![Mediator topology example](https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781491971437/files/assets/sapr_0202.png "Mediator topology example")

## Issues / Challenges

- Remote process availability
- Lack of responsiveness
- Broker reconnection logic in event of broker or mediator failure

> ## References:

- https://aws.amazon.com/event-driven-architecture/
- https://learning.oreilly.com/learning-paths/learning-path-designing/9781492035220/9781491971437-/ch02.html